# MiniBeam v1.0 用户手册（help.pdf 内容源）

## 1. 软件定位与功能概览
MiniBeam 是一个面向一维梁单元（Beam）的快速建模与线弹性求解工具，采用 PyNiteFEA/Pynite 作为求解器。

当前版本支持的核心能力：
1. 一维轴线上建点（Point）并自动按 x 坐标连梁生成构件（Member）。
2. 维护材料与截面参数，并为构件分配材料/截面。
3. 约束条件：DX/DY/DZ/RX/RY/RZ（2D 模式下主要使用 DX、DY、RZ）。
4. 荷载：节点力/节点力矩、杆件均布荷载（Fy 方向，w1~w2 线性变化）。
5. 线弹性求解，输出位移、转角、内力、应力、扭转剪应力、MS（Margin of Safety）。

---

## 2. 单位体系与符号
默认单位体系：
- 长度：mm
- 力：N
- 力矩：N·mm
- 分布荷载：N/mm
- 应力：N/mm²（MPa）

常用符号：
- A：截面积
- Iz：绕 z 轴惯性矩
- J：扭转常数
- c_z：离中性轴最远纤维距离（用于 Mz 弯曲正应力）
- N：轴力
- M：弯矩（Mz）
- T：扭矩（Mx）
- σ_y：材料屈服强度
- FS：安全系数
- MS：安全裕度（Margin of Safety）

---

## 3. 建模操作流程（建议）
1. 新建模型并设置空间模式（2D/3D，常用 2D）。
2. 在画布中按 x 方向布置节点，确认节点顺序正确。
3. 检查自动生成构件（M1、M2、…）是否符合预期。
4. 在材料库中创建/选择材料（E、G、ν、σ_y）。
5. 在截面库中创建/选择截面（A、Iy、Iz、J、c_z）。
6. 为每根构件指定材料与截面。
7. 对节点施加约束（如简支、固支、弹簧支承）。
8. 输入荷载（节点荷载、杆件均布荷载），并设置荷载工况/组合。
9. 点击求解，查看结果图与关键数值（位移、内力、应力、MS）。
10. 根据 MS 和位移等指标迭代截面、边界或荷载。

---

## 4. 求解器原理（线弹性梁有限元）

### 4.1 总体方法
MiniBeam 将模型转换为 PyNite FEModel3D 数据结构：
- 节点 -> FE 节点
- 构件 -> 梁单元
- 材料与截面 -> 单元刚度参数
- 支撑约束/弹簧 -> 边界条件
- 荷载工况与组合 -> 外载向量

随后执行线性静力分析（analyze_linear），求得：
- 节点位移/转角
- 支反力
- 杆件内力分布（N、V、M、T）

### 4.2 结果重采样
不同单元结果会重映射到统一的全局 x 采样线上，便于绘制连续图：
- 挠度图 DY
- 转角图 RZ
- 轴力 N、剪力 V、弯矩 M
- 以及应力与 MS

### 4.3 适用范围与假设
1. 小变形线弹性范围。
2. 未考虑材料非线性、几何非线性与屈曲后行为。
3. 扭转剪应力采用工程简化估计（见后文公式）。

---

## 5. 关键计算公式（重点：MS）

> 下面给出与当前程序一致的完整计算链路（含弹性/塑性修正与扭转-弯曲合成）。

### 5.1 允许应力
允许应力按材料屈服与安全系数给出：

σ_allow = σ_y / FS

其中 FS > 0。

### 5.2 截面应力分项
对每个采样位置 x，程序先取内力 `N(x), Mz(x), My(x), T(x)`，再按截面参数计算：

1) 轴向正应力

σ_axial = N / A

2) 绕 z 轴弯曲正应力

σ_bending,z = Mz * c_z / Iz

3) 绕 y 轴弯曲正应力

σ_bending,y = My * c_y / Iy

4) 两向弯曲正应力合成（避免直接代数相加过保守）

σ_bending,elastic = sign(σ_bending,z + σ_bending,y) * sqrt(σ_bending,z^2 + σ_bending,y^2)

σ_bending = sign(σ_bending,z/k_z + σ_bending,y/k_y) * sqrt((σ_bending,z/k_z)^2 + (σ_bending,y/k_y)^2)

5) 扭转剪应力（工程简化）

τ_t,elastic = T * r_max / J

其中 r_max = max(c_y, c_z)。

### 5.3 弹性值与塑性修正值
程序支持截面形状系数修正（默认不小于 1.0）：

k_z = max(shape_factor_z, 1)
k_y = max(shape_factor_y, 1)
k_t = max(shape_factor_t, 1)

弹性正应力合成：

σ_elastic = σ_axial + σ_bending,elastic

塑性修正后的正应力：

σ = σ_axial + σ_bending

塑性修正后的扭转剪应力：

τ_t = τ_t,elastic / k_t

### 5.4 von Mises 等效应力（含扭转）
程序把正应力与扭转剪应力按 von Mises 合成：

σ_eq,elastic = sqrt(σ_elastic^2 + 3 * τ_t,elastic^2)

σ_eq = sqrt(σ^2 + 3 * τ_t^2)

### 5.5 MS（Margin of Safety）定义
分别输出弹性 MS 与塑性修正 MS：

MS_elastic = σ_allow / |σ_eq,elastic| - 1

MS = σ_allow / |σ_eq| - 1

判定规则：
- MS > 0：满足（有裕度）
- MS = 0：临界
- MS < 0：不满足（超限）

### 5.6 典型算例（逐步代入，便于校对）
已知：
- 材料屈服 `σ_y = 345 MPa`，安全系数 `FS = 1.5`
- 内力：`N = 20,000 N`, `Mz = 8,000,000 N·mm`, `My = 1,500,000 N·mm`, `T = 600,000 N·mm`
- 截面：`A = 2,500 mm^2`, `Iz = 8,000,000 mm^4`, `Iy = 3,000,000 mm^4`, `J = 500,000 mm^4`
- 几何：`c_z = 75 mm`, `c_y = 40 mm`
- 形状系数：`k_z = 1.12`, `k_y = 1.05`, `k_t = 1.20`

步骤 1：允许应力

σ_allow = 345 / 1.5 = 230 MPa

步骤 2：轴向/弯曲应力

σ_axial = 20000 / 2500 = 8.000 MPa

σ_bending,z = 8000000 * 75 / 8000000 = 75.000 MPa

σ_bending,y = 1500000 * 40 / 3000000 = 20.000 MPa

步骤 3：正应力合成（弹性与修正）

σ_bending,elastic = sqrt(75.000^2 + 20.000^2) = 77.621 MPa

σ_bending = sqrt((75.000/1.12)^2 + (20.000/1.05)^2)
          = sqrt(66.964^2 + 19.048^2)
          = 69.621 MPa

σ_elastic = 8.000 + 77.621 = 85.621 MPa

σ = 8.000 + 69.621 = 77.621 MPa

步骤 4：扭转剪应力

r_max = max(75, 40) = 75 mm

τ_t,elastic = 600000 * 75 / 500000 = 90.000 MPa

τ_t = 90.000 / 1.20 = 75.000 MPa

步骤 5：von Mises 等效应力

σ_eq,elastic = sqrt(85.621^2 + 3*90.000^2)
            = sqrt(7330.934 + 24300)
            = sqrt(31630.934)
            = 177.851 MPa

σ_eq = sqrt(77.621^2 + 3*75.000^2)
     = sqrt(6024.956 + 16875)
     = sqrt(22899.956)
     = 151.327 MPa

步骤 6：MS

MS_elastic = 230 / 177.851 - 1 = 0.2932

MS = 230 / 151.327 - 1 = 0.5199

结论：该工况下 `MS > 0`，满足强度要求；并且塑性修正后裕度由 `0.2932` 提升至 `0.5199`。

### 5.7 设计反推关系（常用）
若目标要求 `MS_target`，可反推允许等效应力：

|σ_eq| <= σ_allow / (1 + MS_target)

例如 `MS_target = 0.25`，则 `|σ_eq| <= 0.8 * σ_allow`。

---

## 6. 结果解读建议
1. 先看最大位移与转角是否满足使用要求。
2. 再看弯矩峰值位置是否与荷载/边界逻辑一致。
3. 对应力与 MS：
   - 优先关注 MS 最小值及其对应位置。
   - 若 MS 明显为负，优先增大 Iz、A 或改变边界以降弯矩。
4. 若扭转载荷显著，应额外核验 τ_torsion 与截面抗扭能力。

---

## 7. 常见问题与排查
1. 无法求解：检查是否安装 PyNiteFEA。
2. 结果异常大：检查约束是否缺失导致机构运动。
3. MS 过低：
   - 提升材料 σ_y
   - 降低 FS（须符合规范）
   - 增大 A/Iz/J
   - 优化载荷路径与支承
4. 图上不连续：确认节点 x 坐标顺序及构件连接关系正确。

---

## 8. 版本与说明
- 本手册对应 **MiniBeam v1.0.0**（Phase-1 稳定版）功能范围。
- v1.0 维持线弹性求解主线，支持材料/截面管理、约束与荷载建模、结果与 MS 评估。
- 后续若引入非线性、屈曲或疲劳评估，MS 定义应按相应准则扩展。
